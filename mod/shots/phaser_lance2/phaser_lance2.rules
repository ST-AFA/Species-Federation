ID = "stafa.fed_phaser_lance"
Range = { BaseValue=600; BuffType=CaptainsRoomBuff; BuffMode=Multiply; MaxValue=220; }
IdealRange
[
	{ BaseValue=560; BuffType=CaptainsRoomBuff; BuffMode=Multiply; MaxValue=20; }
	{ BaseValue=585; BuffType=CaptainsRoomBuff; BuffMode=Multiply; MaxValue=210; }
]
Width = 12
Duration = 1
HitInterval = .01
SourceShipLowCollisions = false
// CrewCollisions = {Enemies=true; Junk=true}
Speed = 999999999999

BeamMediaEffects
[
	// The beam itself.
	{
		Type = Beam
		BeamSprite
		{
			Texture
			{
				File = "beam.png"
				SampleMode = Linear
				MipLevels = 1
				UVMode = Clamp
			}
			_noiseTexture
			{
				File = ./Data/common_effects/particles/noise_voronoi.png
				SampleMode = Linear
				MipLevels = max
				UVMode = Wrap
			}
			Shader = "beam.shader"
			_gradientPow = 0.35
			_sineFreq = 2.5
			_sineAmp = 0.03
			_noiseAmp = 0.12
			_gradientIntensity = 3
			_endCapSize = .125
			Size = [100%, 8]
			VertexColor = [255, 255, 255, 217]
			TargetBlendMode
			{
				SourceRgbFactor = SourceAlpha
				DestRgbFactor = One
				RgbOperator = Add
				SourceAlphaFactor = One
				DestAlphaFactor = One
				AlphaOperator = Add
			}
		}
		FadeInTime = .25
		FadeOutTime = .25
		RandomTimeOffset = [0, 1]
		Bucket = Lower1
	}
	&<particles/phaser_beam_emit_sparks.rules>
	&<particles/phaser_beam_hit.rules>
	&<particles/phaser_beam_hit_flash.rules>
	// Beam lighting.
	{
		Type = Beam
		BeamSprite
		{
			Texture
			{
				File = "beam.png"
				MipLevels = max
				SampleMode = Linear
			}
			Shader = "./Data/common_effects/fancy_beam_light.shader"
			Size = [100%, 8]
			_extraBeginLength = 7
			_extraEndLength = 7
			VertexColor = [255, 255, 0, 255]
			_z = 0.1
			_litReflectiveStrength = 8
			_litAdditiveStrength = 0
			_unlitAdditiveStrength = 0.25
			_nrmlStrengthLimit = 0.2
			TargetBlendMode
			{
				SourceRgbFactor = InverseDestColor
				DestRgbFactor = One
				RgbOperator = Add
				SourceAlphaFactor = Zero
				DestAlphaFactor = One
				AlphaOperator = Add
			}
		}
		Bucket = Lower1
		IsLight = true
		FadeInTime = .5
		FadeOutTime = .1
	}

	: /BASE_SOUNDS/AudioExterior
	{
		Sound = "light_phasor_beam.wav"
		Volume = 1
		Speed = 1
		MaxConcurrent = 1
		RampUpTime = .5
		RampDownTime = .5

		DynamicVolume : ^/0/DynamicVolume
		{
			UseCustomShapeForDistance = true
		}
		DynamicFilter : ^/0/DynamicFilter
		{
			UseCustomShapeForDistance = true
		}
	}

]

Components
{
	Physics
	{
		Type = CirclePhysics
		Radius = 0.2
		Density = 0.01
	}

	// Death
	// {
	// 	Type = DeathByLifetime
	// 	// Lifetime will be auto-calculated based on range and speed.
	// }
	Targetable
	{
		Type = Targetable
		Health = 9000
		TargetCategory = "laser"
	}
	DamagePool
	{
		Type = DamagePool
		Damage = { BaseValue=1200; BuffType=CaptainsRoomBuff; BuffMode=Multiply; MaxValue=1800; }
	}

	Hit
	{
		Type = PenetratingHit
		Penetration = { BaseValue=2; BuffType=CaptainsRoomBuff; BuffMode=Multiply; MaxValue=4; }
		PenetrationSpeed = &~/Speed
		FactorEffectsWith = Targetable
		SourceShipLowCollisions = false
		CrewCollisions = {Enemies=true; Junk=true}
		HitCrew = &HitOperational

		HitShield
		{
			HitEffects
			[
				: ../../HitOperational/HitEffects/0
				{
					Amount = 800
					TreatShieldAsPart = true
				}
			]

			MediaEffects = &../HitOperational/MediaEffects
		}
		HitOperational
		{
			Offset = [-0.15, 0]

			HitEffects
			[
				{
					Type = ExplosiveDamage
					TotalDamage = 2500
					Radius = 1.5
					DamagePool = DamagePool
				}
				{
					Type = Impulse;
					Impulse = 10;
				}
			]

			MediaEffects
			[
				&<particles/phaser_beam_emit_sparks.rules>
				&<particles/phaser_beam_hit.rules>
				&<particles/phaser_beam_hit_flash.rules>

				: /BASE_SOUNDS/AudioExterior
				{
					Sound = "light_phasor_beam.wav"
					Volume = .3
					SpeedVariation = .4
				}

				: /BASE_SHAKE
				{
					ShakeAmount = .03
					Duration = .3
				}
			]
		}
		HitStructural
		{
			HitEffects
			[
				{
					Type = Damage
					Damage = { BaseValue=600; BuffType=CaptainsRoomBuff; BuffMode=Multiply; MaxValue=1200; }
				}
				{
					Type = Impulse;
					Impulse = 10;
				}
			]

			MediaEffects
			[
				&<particles/phaser_beam_emit_sparks.rules>
				&<particles/phaser_beam_hit.rules>
				&<particles/phaser_beam_hit_flash.rules>

				: /BASE_SOUNDS/AudioExterior
				{
					Sound = "light_phasor_beam.wav"
					Volume = .3
					SpeedVariation = .4
				}
			]
		}
		PenetratingOperational
		{
			ReduceEffectsByPenetration = true

			HitEffects
			[
				{
					Type = ExplosiveDamage
					TotalDamage = { BaseValue=4000; BuffType=CaptainsRoomBuff; BuffMode=Multiply; MaxValue=1800; }
					DamagePool = DamagePool
					DoPooledDamageFirst = true
					Radius = 3
				}
				{
					Type = Impulse
					Impulse = 100
				}
			]
			MediaEffects
			[
				&<particles/phaser_beam_emit_sparks.rules>
				&<particles/phaser_beam_hit.rules>
				&<particles/phaser_beam_hit_flash.rules>

				: /BASE_SOUNDS/AudioExterior
				{
					Sound = "light_phasor_beam.wav"
					Volume = .3
					SpeedVariation = .4
				}
			]
		}
		PenetratingStructural
		{
			// No effect.
		}
		FinishedPenetratingOperational = &PenetratingOperational
		FinishedPenetratingStructural = &PenetratingStructural
		FinishedPenetratingOperational
		{
			// No effect.
		}
		FinishedPenetratingStructural
		{
			// No effect.
		}
	}

	// Sprite
	// {
	// 	Type = Sprite
	// 	ReduceScaleWith = Hit
	// 	ReduceScaleExponent = 0.5
	// 	Sprite
	// 	{
	// 		Texture
	// 		{
	// 			File = "phaser_dual_bolt.png"
	// 			SampleMode = Linear
	// 			MipLevels = max
	// 		}
	// 		Size = [2, 2]
	// 	}
	// }

	// GlowSprite
	// {
	// 	Type = Sprite
	// 	RenderBucket = BulletUpper4
	// 	Z = 0
	// 	IsLight = true
	// 	Sprite
	// 	{
	// 		Texture
	// 		{
	// 			File = "./Data/common_effects/particles/blob.png"
	// 			MipLevels = max
	// 			SampleMode = Linear
	// 		}
	// 		Size = [4, 4]
	// 		VertexColor = [255, 147, 15]
	// 		TargetBlendMode = Add
	// 		Shader = "./Data/common_effects/fancy_light.shader"
	// 		_litReflectiveStrength = 24
	// 		_litAdditiveStrength = 0.05
	// 		_unlitAdditiveStrength = 0.25
	// 	}
	// }
}